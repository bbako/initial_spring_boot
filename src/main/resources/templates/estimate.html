<div th:insert="./common/link.html"></div>
<div th:insert="./common/header.html"></div>

<style>
    .label2 {
        text-align: right;
        clear: both;
        float:left;
        margin-right:15px;
    }

    .table-hover tbody tr:hover > td {
        background-color: #ffe0e3;
    }

</style>
<div class="ht__bradcaump__area" style="background: rgba(0, 0, 0, 0) url(/static/images/bg/2.jpg) no-repeat scroll center center / cover ;">
    <div class="ht__bradcaump__wrap">
        <div class="container">
            <div class="row">
                <div class="col-xs-12">
                    <div class="bradcaump__inner text-center">
                        <h2 class="bradcaump-title">견적 문의</h2>
                        <nav class="bradcaump-inner">
                            <a class="breadcrumb-item">서일테크놀로지 T.032-589-7772로 문의 하시면 <br>
                                더 빠른 상담이 가능합니다.
                            </a>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Bradcaump area -->
<!-- Start Our Product Area -->
<section class="bg__white">
    <div class="container">
        <div role="tabpanel" class="product__tab__content active">

            <div>
                <button type="button" class="esti-btn" onclick="showmodal()">견적 문의 하기</button>
            </div>
            <!-- Start RAting Area -->
            <div class="rating__wrap" style="margin-top: 40px;">
                <h2 class="rating-title">견적 문의</h2>
            </div>
            <!-- End RAting Area -->

            <div class="review__address__inner" style="margin-top: 20px; width: 100%; overflow-x: auto;white-space: nowrap" >
                <table class="table table-sm table-hover" style="min-width: 420px">
                    <colgroup>
                        <col width="3%">
                        <col width="45%">
                        <col width="22%">
                        <col width="30%">
                    </colgroup>
                    <thead>
                    <tr>
                        <th scope="col">No.</th>
                        <th scope="col">제목</th>
                        <th scope="col">상호</th>
                        <th scope="col">등록일</th>
                    </tr>
                    </thead>
                    <tbody id="esti_table">
                    </tbody>
                </table>
            </div>
        </div>
        <!-- End Single Content -->
    </div>
</section>

<!-- Modal -->
<div class="modal fade" id="estiModal" tabindex="-1" role="dialog" aria-labelledby="estiModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">견적 문의 하기</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group row">
                        <label for="e_name" class="col-sm-3 col-form-label">1. 성함 또는 상호명</label>
                        <div class="col-sm-9">
                            <input type="hidden" class="form-control" id="e_seq_modi">
                            <input type="text" class="form-control" id="e_name">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="e_email" class="col-sm-3 col-form-label">2. 답변 받을 E-Mail. 주소</label>
                        <div class="col-sm-9">
                            <input type="email" class="form-control" id="e_email">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="e_tel" class="col-sm-3 col-form-label">3. 전화번호 </label>
                        <div class="col-sm-9">
                            <input type="email" class="form-control" id="e_tel">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="e_pass" class="col-sm-3 col-form-label">4. 견적 확인 비밀번호 <i class="zmdi zmdi-lock"></i></label>
                        <div class="col-sm-9">
                            <input type="password" class="form-control" id="e_pass">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="e_title" class="col-sm-3 col-form-label">5. 견적 문의 제목</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="e_title">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="e_content" class="col-sm-3 col-form-label">6. 견적 문의 내용</label>
                        <div class="col-sm-9">
                            <textarea type="text" class="form-control" id="e_content" rows="10"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                <button id="modal_btn" type="button" class="btn btn-primary uploadBtn" onclick="regi_esti()">등록</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->

<!-- Modal -->
<div class="modal fade" id="estiPassModal" tabindex="-1" role="dialog" aria-labelledby="estiPassModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">견적 내용 확인</h4>
            </div>
            <div class="modal-body">
                <h3>견적 확인 비밀번호</h3>
                <div style="margin-top: 10px">
                    <input type="text" class="form-control" id="e_pass_check">
                    <input type="hidden" class="form-control" id="e_seq">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
                <button type="button" class="btn btn-primary uploadBtn" onclick="check_esti_pass()">확인</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div th:insert="./common/footer.html"></div>

<script>

    getlist();

    $('#e_pass_check').keypress(function(event){
        var keycode = (event.keyCode ? event.keyCode : event.which);
        if(keycode == '13'){
            check_esti_pass();
        }
    });

    function regi_esti(){

        var formData = new FormData();

        formData.append("estiName", $("#e_name").val());
        formData.append("estiEmail", $("#e_email").val());
        formData.append("estiTel", $("#e_tel").val());
        formData.append("estiPassword", $("#e_pass").val());
        formData.append("estiTitle", $("#e_title").val());
        formData.append("estiContent", $("#e_content").val());

        if( !$("#e_name").val() ||
            !$("#e_email").val() ||
            !$("#e_tel").val() ||
            !$("#e_pass").val() ||
            !$("#e_title").val() ||
            !$("#e_content").val()) {
           alert("모든항목을 입력해 주세요");

        }else{
            var url_v = "";
            if(!$("#e_seq_modi").val()){
                url_v = '/regiEsti';
            }else{
                url_v = '/modiEsti';
                formData.append("estiSeq", $("#e_seq_modi").val());
            }

            $.ajax({
                url: url_v,
                processData: false,
                contentType: false,
                data: formData,
                type: 'POST',
                dataType:'text',
                success: function(result){
                    $('#estiModal').modal('hide');
                    $("#e_name").val("");
                    $("#e_email").val("");
                    $("#e_tel").val("");
                    $("#e_pass").val("");
                    $("#e_title").val("");
                    $("#e_content").val("");

                    getlist();
                },
                error: function(jqXHR, textStatus, errorThrown){
                    console.log(textStatus);
                }
            });
        }
    }

    function getlist(){
        $.ajax({
            url: '/getEsti',
            processData: false,
            contentType: false,
            data: {},
            type: 'POST',
            dataType:'json',
            success: function(result){
               $("#esti_table").empty();

                var str = '';

                for(var i = 0; i < result.length; i++){
                    str += ' <tr style="cursor: pointer" onclick="showContents('+ result[i].estiSeq +')">'+
                                '<td><a>'+result[i].rowNum+'</a></td>'+
                                '<td><a>'+result[i].estiTitle+' <i class="zmdi zmdi-lock"></i></a></td>'+
                                '<td><a>'+result[i].estiName+'</a></td>'+
                                '<td><a>'+result[i].estiRegdate+'</a></td>'+
                            '</tr>';
                }
                $("#esti_table").append(str);


            },
            error: function(jqXHR, textStatus, errorThrown){
                console.log(textStatus);
            }

        });
    }

    function showContents(seq){
        $('#estiPassModal').modal('show');
        $("#e_seq").val(seq);
    }

    function check_esti_pass(){
        var formData = new FormData();

        formData.append("estiSeq", $("#e_seq").val());
        formData.append("estiPassword", $("#e_pass_check").val());

        if( !$("#e_pass_check").val()) {
            alert("비밀번호를 입력해 주세요");
        }else{
            $.ajax({
                url: '/showContents',
                processData: false,
                contentType: false,
                data: formData,
                type: 'POST',
                dataType:'JSON',
                success: function(result){
                    $('#estiPassModal').modal('hide');

                    $("#e_seq_modi").val(result.estiSeq);
                    $("#e_name").val(result.estiName);
                    $("#e_email").val(result.estiEmail);
                    $("#e_tel").val(result.estiTel);
                    $("#e_title").val(result.estiTitle);
                    $("#e_content").val(result.estiContent);
                    if(result.estiPassword=="pass"){
                        $("#modal_btn").prop('disabled', true);
                        $("#e_pass").prop('disabled', true);
                        $("#e_name").prop('disabled', true);
                        $("#e_email").prop('disabled', true);
                        $("#e_tel").prop('disabled', true);
                        $("#e_title").prop('disabled', true);
                        $("#e_content").prop('disabled', true);
                    }else{
                        $("#modal_btn").prop('disabled', false);
                        $("#modal_btn").text('수정');
                        $("#e_pass").val(result.estiPassword);
                        $("#e_pass").prop('disabled', false);
                        $("#e_name").prop('disabled', false);
                        $("#e_email").prop('disabled', false);
                        $("#e_tel").prop('disabled', false);
                        $("#e_title").prop('disabled', false);
                        $("#e_content").prop('disabled', false);
                    }

                    $('#estiModal').modal('show');

                },
                error: function(jqXHR, textStatus, errorThrown){
                    console.log(textStatus);
                    alert("비밀번호 오류 입니다.")
                    $('#estiPassModal').modal('hide');
                }

            });
        }
    }
    function showmodal(){
        $('#e_seq_modi').val("");
        $("#e_name").val("");
        $("#e_email").val("");
        $("#e_tel").val("");
        $("#e_pass").val("");
        $("#e_title").val("");
        $("#e_content").val("");

        $("#modal_btn").prop('disabled', false);
        $("#e_pass").prop('disabled', false);
        $("#e_name").prop('disabled', false);
        $("#e_email").prop('disabled', false);
        $("#e_tel").prop('disabled', false);
        $("#e_title").prop('disabled', false);
        $("#e_content").prop('disabled', false);

        $("#modal_btn").text('등록');
        $('#estiModal').modal('show');
    }

</script>